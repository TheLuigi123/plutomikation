<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Koalas Multiplikations-Abenteuer</title>
    <style>
        /* CSS */
        html, body { height: 100%; margin: 0; overflow: hidden; font-family: sans-serif; background-color: #e0f7fa; }
        #start-screen { position: fixed; inset: 0; background-color: #a2d5ab; color: #333; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 110; padding: 20px; text-align: center; overflow-y: auto; }
        /* ... other styles ... */
        #play-again-button:hover { background-color: #45a049; }
        @media (min-width: 600px) { #numpad-container button { padding: 15px 0; } }
    </style>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

</head>
<body>
    <!-- HTML Structure -->
    <div id="start-screen"><h2>Willkommen...</h2><!-- ... --></div>
    <div id="game-area" class="hidden"><div id="hero"></div><div id="enemy" class="hidden"></div></div>
    <div id="inventory" class="hidden">Blumen: 0</div>
    <div id="quiz-modal" class="hidden"><!-- ... --></div>
    <div id="end-screen" class="hidden"><!-- ... --></div>

    <script>
        console.log("SCRIPT START");

        // --- Firebase Konfiguration ---
        var firebaseConfig = { /* ... verified config ... */
             apiKey: "AIzaSyAJWO7g9Xgy-c2nX8ovNpSlqmuFp_EZy9Q", authDomain: "blumen-b5bac.firebaseapp.com", projectId: "blumen-b5bac", storageBucket: "blumen-b5bac.firebasestorage.app", messagingSenderId: "699410546284", appId: "1:699410546284:web:5be1a7fd826d324f95a249", measurementId: "G-1LPR6QT9GR", databaseURL: "https://blumen-b5bac-default-rtdb.europe-west1.firebasedatabase.app/"
         };
        try {
            firebase.initializeApp(firebaseConfig);
            var database = firebase.database();
            console.log("Firebase Initialized");
        } catch (e) { console.error("FIREBASE INIT FAILED:", e); }

        // --- DOM Elemente ---
        var startScreen = document.getElementById('start-screen');
        var playerNameInput = document.getElementById('player-name');
        var startGameButton = document.getElementById('start-game-button');
        var globalHighscoreBody = document.getElementById('global-highscore-body');
        var localHighscoreBody = document.getElementById('local-highscore-body');
        var gameArea = document.getElementById('game-area');
        var hero = document.getElementById('hero');
        var inventoryDisplay = document.getElementById('inventory');
        var quizModal = document.getElementById('quiz-modal');
        var quizTitle = document.getElementById('quiz-title');
        var quizQuestion = document.getElementById('quiz-question');
        var quizInputDisplay = document.getElementById('quiz-input-display');
        var quizMessage = document.getElementById('quiz-message');
        var numpadContainer = document.getElementById('numpad-container');
        var enemyElement = document.getElementById('enemy');
        var endScreen = document.getElementById('end-screen');
        var finalTimeDisplay = document.getElementById('final-time');
        var localEndHighscoreBody = document.getElementById('local-end-highscore-body');
        var wrongAnswersList = document.getElementById('wrong-answers-list');
        var playAgainButton = document.getElementById('play-again-button');
        console.log("DOM Elements Referenced");

        // --- Audio Context & Sounds --- DELETED
        console.log("Audio section deleted.");


        // *** Spielzustand Variables - COMMENT REMOVED ***
        // *** Ensure there are NO hidden characters or weird spaces around here ***
        var currentPlayerName = "Anonym";
        var currentLevel = 1;
        var flowersCollected = 0;
        var flowers = [];
        var activeItem = null;
        var activeItemType = null;
        var currentQuestions = [];
        var currentQuestionIndex = 0;
        var correctAnswersForItem = 0;
        var heroIsMoving = false;
        var gameIsOver = false;
        var startTime = 0;
        var wrongAnswersLog = {};
        var monsterEncounters = 0;
        var localHighScores = [];
        console.log("Game state variables DECLARED."); // Log confirms this block was parsed


        // --- Konfiguration (using var) ---
        var FLOWER_GOAL = 20;
        var CORRECT_ANSWERS_NEEDED_FOR_FLOWER = 3;
        var NUM_QUESTIONS_PER_ENEMY = 5;
        var NUM_QUESTIONS_TO_GENERATE = 5;
        var flowerColors = [ { bg: '#f48fb1', border: '#ad1457' }, { bg: '#90caf9', border: '#1e88e5' }, { bg: '#ffe082', border: '#ffab00' }, { bg: '#a5d6a7', border: '#388e3c' }, { bg: '#b39ddb', border: '#5e35b1' } ];
        console.log("Config variables declared.");

        // --- Feind Konfiguration & Zustand (using var) ---
        var BASE_ENEMY_STEP_SIZE = 10;
        var BASE_ENEMY_MOVE_INTERVAL = 200;
        var ENEMY_RANDOM_FACTOR = 4;
        var ENEMY_FREEZE_DURATION = 10000;
        var ENEMY_SPAWN_DELAY = 5000;
        var currentEnemyStepSize = BASE_ENEMY_STEP_SIZE;
        var currentEnemyMoveInterval = BASE_ENEMY_MOVE_INTERVAL;
        var enemyData = { element: enemyElement, position: { x: -100, y: -100 }, active: false, frozen: false, freezeTimeoutId: null, moveIntervalId: null };
        console.log("Enemy config declared.");

        // --- Initialisierung ---
        function initGame() {
            console.log("initGame called (empty)");
        }

        // --- Start Screen Logic ---
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOMContentLoaded event fired");
            try {
                var savedName = localStorage.getItem('lastPlayerName');
                if (savedName && playerNameInput) {
                    playerNameInput.value = savedName;
                    console.log("Player name loaded");
                }
                console.log("High score functions skipped");
                if (startGameButton) {
                    startGameButton.addEventListener('click', function() {
                        console.log("Start Game Button Clicked (inner logic commented)");
                        /* // Inner logic still commented
                        var name = "";
                        if(playerNameInput) { name = playerNameInput.value.trim(); }
                        if (!name) { console.log("Player name missing"); return; }
                        currentPlayerName = name; // Assign to variable from active state block
                        localStorage.setItem('lastPlayerName', name);
                        if(startScreen) { startScreen.classList.add('hidden'); }
                        console.log("Starting game setup (calling initGame)");
                        initGame();
                        */
                    });
                    console.log("Start button listener added");
                } else { console.error("Start game button not found!"); }
            } catch(e) { console.error("Error in DOMContentLoaded:", e); }
        });


        // --- ALL GAME LOGIC FUNCTIONS COMMENTED OUT OR EMPTY ---
        // ... function stubs ...
        function handleFirstClick(event) { /* ... */ }
        function setupLevel() { /* ... */ }
        // ... other functions ...

        // *** Keep formatTime function commented out ***
        /*
        function formatTime(milliseconds) { // ... }
        */
        console.log("formatTime function skipped.");

        function loadLocalHighScores() { /* ... */ }
        // ... other function stubs ...
        function endGame() { /* ... */ }

        // --- Hilfsfunktionen ---
        // Keep uncommented
        function getRandomPosition(bounds, margin) {
             var w = bounds.width || window.innerWidth; var h = bounds.height || window.innerHeight;
             var sz = 40; var x = Math.random() * (w - margin * 2 - sz) + margin; var y = Math.random() * (h - margin * 2 - sz) + margin;
             return { x: x, y: y };
        }
        function escapeHtml(unsafe) {
             if (!unsafe) return "";
             return unsafe.replace(/&/g, "&").replace(/</g, "<").replace(/>/g, ">").replace(/"/g, """).replace(/'/g, "'");
        }
        console.log("Helper functions defined.");

        console.log("SCRIPT END");
    </script>
</body>
</html>
